# 트랜잭션 스크립트

비트코인에서 스크립트(script)는 스택 기반의 아주 단순한 [[프로그래밍 언어]]이다. 비트코인은 스크립트로 작성된 코드를 읽어 이를 실행하면서 코인 트랜잭션을 수행한다. 비트코인 스크립트 언어는 루프(loop)를 허용하지 않는 제한된 언어인데, 이 스크립트 부분을 확장하여 다양한 코드를 쓸 수 있게 하면서 [[스마트 컨트랙트]](smart contract)를 수행할 수 있게 한 것이 이더리움(Ethereum)이다.

비트코인의 트랜잭션 스크립트는 프로그래밍 언어이므로 트랜잭션에 다양한 스크립트를 넣을 수 있게 되어 있지만, 일반적으로 사용되는 표준 스크립트(standard script)로는 P2PKH (pay to pubkey hash), P2SH (pay to script hash), P2PK (pay to pubkey), P2MS (pay to multisig) 등이 있다. 현재 가장 많이 사용되는 것은 P2PKH와 P2SH 스크립트이다.

비트코인에서 가장 전형적인 트랜잭션 스크립트인 P2PKH 는 다음과 같은 구조로 되어 있다.
> OP_DUP OP_HASH160 {publicKeyHash} OP_EQUALVERIFY OP_CHECKSIG

여기서 OP_ 로 시작되는 것들은 OPCode라고 불리우는 것으로, 스크립트의 명령어에 해당된다. 예를 들어, OP_DUP (0x76)은 스택(stack)의 가장 위에 있는 데이타를 복제해서 스택에 넣으라는 명령이고, OP_HASH160 (0xa9)은 스택의 가장 위에 있는 데이타를 RIPEMD160 해시로 해싱하라는 명령어이다.

{publicKeyHash} 에는 코인을 받는 사람의 공개키(public key)를 RIPEMD160 으로 해싱한 해시값이 들어간다. 예를 들어, 20 바이트의 RIPEMD160 해시값인 513b8dc588ca9d5787dde7eb29569da63c3b1434 과 같은 값이 여기에 들어간다.

OP_EQUALVERIFY (0x88)는 스택 상의 두개의 값이 같은지를 비교하는 것이고, OP_CHECKSIG (0xac)는 서명이 올바른 서명인지를 체크하는 명령어이다.

일반적으로 트랜잭션 출력의 스크립트(ScriptPubKey)는 단독으로 실행되지 않으며, 트랜잭션 출력에 표시된 코인 수급자가 코인을 다른 사람에게 보내려고 할 때 작성하는 입력 트랜잭션과 맞물려 실행된다. 즉, **[[트랜잭션 출력]]에 지정된 공개키(public key)에 상응하는 개인키(private key)를 가진 사람이 트랜잭션 입력(transaction input)에서 그 트랜잭션 출력(transaction output)을 사용하도록 서명을 하면, 이때의 "{트랜잭션 입력} + {이전의 트랜잭션 출력}" 을 합친 스크립트를 실행하게 된다.** 스크립트의 마지막 코드인 OP_CHECKSIG 에서 서명이 맞는지 체크하게 되는데, 이것이 맞으면 개인키를 가진 올바른 사용자가 이 트랜잭션을 서명하였음을 인정하게 된다.

트랜잭션 출력에서의 출력 스크립트의 크기(ScriptPubKeySize)는 가변길이로 이루어진 정수로 지정하는데, 이 가변 길이 정수(Variable length integer)는 숫자 범위에 따라 1 ~ 9 바이트까지 가변적인 길이를 갖는다.

[//begin]: # "Autogenerated link references for markdown compatibility"
[트랜잭션 출력]: <트랜잭션 출력> "트랜잭션 출력"
[//end]: # "Autogenerated link references"